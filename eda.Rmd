---
title: "EDA. Case Study 2 - Group 4"
author: "Keru Wu"
output: pdf_document
toc: true
number_sections: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 1. Load Data

```{r cars}
dat = read.csv('AB_NYC_2019.csv', na.strings = c("", "NA"))

library(purrr)
library(tidyr)
library(ggplot2)

dat %>%
  keep(is.numeric) %>% 
  gather() %>% 
  ggplot(aes(value)) +
    facet_wrap(~ key, scales = "free") +
    geom_histogram()

```


```{r}
lapply(dat, class)

```

# 2. Missing Data Manipulation

```{r}
apply(dat, 2, function(x)(sum(is.na(x))))
dat = dat[, !names(dat) %in% c('id', 'host_name','last_review')]
dat$reviews_per_month[is.na(dat$reviews_per_month)] = 0
apply(dat, 2, function(x)(sum(is.na(x))))
```

# 3. EDA plots

```{r}

library(jpeg)
library(ggpubr)
library(grid)

img = readJPEG("New_York_City_.jpg")
```


## 3.1 Neighbourhood Count

```{r}
ggplot(dat, aes(x=neighbourhood_group)) +
  geom_bar(aes(fill=neighbourhood_group))

ggplot(dat, aes(x=neighbourhood)) +
  geom_bar(aes(fill=neighbourhood), show.legend = FALSE) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, size=5))
```

## 3.2 Maps
```{r}

jet.colors <- colorRampPalette(c("#00007F", "blue", "#007FFF", "cyan", "#7FFF7F", "yellow", "#FF7F00", "red", "#7F0000"))

ggplot(dat, aes(x=longitude, y = latitude, color = log(1+price)))+
  annotation_custom(rasterGrob(img, 
                               width = unit(1,"npc"), 
                               height = unit(1,"npc")), 
                    -74.258, -73.69, 40.49,40.92) + 
  geom_point(cex = 0.4) +
  scale_colour_gradientn(colors = jet.colors(7), limits = c(3,7)) 


ggplot(dat, aes(x=longitude, y = latitude, color = availability_365))+
  annotation_custom(rasterGrob(img, 
                               width = unit(1,"npc"), 
                               height = unit(1,"npc")), 
                    -74.258, -73.69, 40.49,40.92) + 
  geom_point(cex = 0.4) +
  scale_colour_gradient(low = 'red', high = 'grey') 
```


```{r}
ggplot(dat, aes(x=longitude, y = latitude, color = neighbourhood_group))+
  annotation_custom(rasterGrob(img, 
                               width = unit(1,"npc"), 
                               height = unit(1,"npc")), 
                    -74.258, -73.69, 40.49,40.92) + 
  geom_point(cex = 0.4) 

```

## 3.3 Neighbourhood Group

```{r}
ggplot(dat, aes(x=neighbourhood_group, y = log(1+price), fill = neighbourhood_group))+
  geom_violin() + 
  ggtitle('Neighbourhood group: price KDE')

ggplot(dat, aes(x=neighbourhood_group, y = availability_365, fill = neighbourhood_group))+
  geom_violin() + 
  ggtitle('Neighbourhood group: availability KDE')

```


```{r}
ggplot(dat, aes(x = neighbourhood_group))+
  geom_bar(aes(fill = room_type), position='dodge')+
  ggtitle("Neighbourhood group: room type")

```


## 3.4 Number of Reviews
```{r}
dat1 <- dat[with(dat,order(-number_of_reviews)),]

dat1[1:10,]


```


# 4. Word Count
```{r}
Names = paste(dat$name, collapse = " ")
Names = strsplit(Names, " ")[[1]]
Names = table(Names)

library(dplyr)
freq = Names %>% as.data.frame() %>% arrange(desc(Freq))

ggplot(freq[1:30,], aes(x = reorder(Names, -Freq), y = Freq))+
  geom_bar(stat = "identity", aes(fill = Names), show.legend = FALSE)+ 
  xlab("Word")+
  theme(axis.text.x = element_text(angle = 90, hjust = 1, size=10))

```

# 5. 

# 5. Regression

## 5.1 Linear Regression

## 5.2 LASSO

## 5.3 Decision Tree \& Random Forest

## 5.4 

